# 规则处理

## 规则来源

20 条书源规则来自参考项目 **SoNovel**（novel-main），每条规则是一个 JSON 文件，定义了一个小说网站的搜索、书籍详情、目录、章节内容的解析方式（CSS 选择器、请求方式、过滤规则等）。

### 参考资料中的相关文件

| 文件 | 说明 |
|------|------|
| `参考文档/novel-main/novel-main/src/main/resources/rule/rule-1.json` ~ `rule-20.json` | 20 个书源的 JSON 规则定义 |
| `参考文档/novel-main/novel-main/src/main/resources/rule/rule-template.json` | 规则模板，定义了所有可用字段的完整结构 |
| `参考文档/novel-main/novel-main/src/main/resources/rule/rule-unavailable.json` | 已失效/禁用的规则备份 |
| `参考文档/novel-main/novel-main/BOOK_SOURCES.md` | 20 个书源的文档说明（名称、URL、IP 可用性、是否支持搜索、注意事项） |

### 20 个书源列表

| ID | 名称 | URL | 备注 |
|----|------|-----|------|
| 1 | 香书小说 | http://www.xbiqugu.la/ | 无限流 |
| 2 | 书海阁小说网 | https://www.shuhaige.net/ | 搜索限流 |
| 3 | 梦书中文 | http://www.mcxs.info/ | 搜索限流 |
| 4 | 鸟书网 | http://www.99xs.info/ | 搜索限流，数量 15w+ |
| 5 | 新天禧小说 | https://www.tianxibook.com/ | 下载过快章节内容为空 |
| 6 | 全本小说网 | https://quanben5.com/ | 需梯子，完本为主 |
| 7 | 69书吧 | https://www.69shuba.com/ | 需梯子，搜索有 CF |
| 8 | 大熊猫文学 | https://www.dxmwx.org/ | |
| 9 | 笔趣阁22 | https://www.22biqu.com/ | |
| 10 | 笔尖中文 | http://www.xbiquzw.net/ | |
| 11 | 零点小说 | https://www.0xs.net/ | 限流，爬取过快封 IP |
| 12 | 得奇小说网 | https://www.deqixs.com/ | 需梯子，频率过快封 IP |
| 13 | ~~新笔趣阁6~~ | ~~https://www.xbqg06.com/~~ | **已禁用** |
| 14 | 略更网 | https://www.luegeng.com/ | |
| 15 | 书林文学 | http://www.shu009.com/ | 目录有重复/缺章 |
| 16 | 速读谷 | https://www.sudugu.com/ | 需梯子 |
| 17 | 八一中文网 | http://www.81zwwww.com/ | |
| 18 | 悠久小说网 | http://www.ujxsw.org/ | |
| 19 | 阅读库 | http://www.yeudusk.com/ | |
| 20 | 顶点小说 | https://www.wxsy.net/ | 搜索/详情/章节限流 |

## ReadStorm 项目中的存储位置

### 源代码目录

`src/ReadStorm.Rules/rules/` — 目前只迁移了 **2 条规则**：

- `rule-1.json`（香书小说）
- `rule-2.json`（书海阁小说网）

### 构建输出目录

`src/ReadStorm.Desktop/bin/` 下的 Debug/Release/publish 目录中的 `rules/` 子目录包含 **全部 22 个文件**（rule-1 ~ rule-20 + template + unavailable）。

## 构建时规则文件的复制机制

在 `src/ReadStorm.Desktop/ReadStorm.Desktop.csproj` 中配置了**两个互斥的 Content 引用**：

```xml
<!-- 优先：直接从参考文档目录复制（条件：该目录存在） -->
<Content Include="..\..\..\参考文档\novel-main\novel-main\src\main\resources\rule\rule-*.json"
         Condition="Exists('..\..\..\参考文档\novel-main\novel-main\src\main\resources\rule')"
         Link="rules\%(Filename)%(Extension)"
         CopyToOutputDirectory="Always" />

<!-- 备用：从 ReadStorm.Rules 项目复制（条件：参考文档目录不存在） -->
<Content Include="..\ReadStorm.Rules\rules\*.json"
         Condition="!Exists('..\..\..\参考文档\novel-main\novel-main\src\main\resources\rule')"
         Link="rules\%(Filename)%(Extension)"
         CopyToOutputDirectory="Always" />
```

### 当前行为

- **参考文档目录存在** → 构建时从参考文档原始 Java 项目复制全部 20 条规则到输出目录
- `ReadStorm.Rules/rules/` 下的 2 个文件**从未被实际使用**
- **如果删除参考文档目录** → 构建退回到 `ReadStorm.Rules/rules/` 下的 2 个文件，程序只有 2 条规则可用

## 待办

- [ ] 将全部 20 条规则迁移到 `src/ReadStorm.Rules/rules/` 目录，使项目不再依赖参考文档目录
- [ ] 规则 13（新笔趣阁6）已禁用，考虑是否从规则集中移除
- [ ] 评估各书源当前可用性，更新规则内容
