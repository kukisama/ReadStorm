using ReadStorm.Application.Abstractions;
using ReadStorm.Domain.Models;

namespace ReadStorm.Infrastructure.Services;

public sealed class HybridSearchBooksUseCase : ISearchBooksUseCase
{
    private readonly RuleBasedSearchBooksUseCase _ruleBased = new();

    public async Task<IReadOnlyList<SearchResult>> ExecuteAsync(
        string keyword,
        int? sourceId = null,
        CancellationToken cancellationToken = default)
    {
        // "全部书源"在当前阶段由真实聚合实现负责；该备份仅保留历史思路。
        if (sourceId is null or <= 0)
        {
            return [];
        }

        try
        {
            var real = await _ruleBased.ExecuteAsync(keyword, sourceId, cancellationToken);
            return real;
        }
        catch
        {
            // 指定书源下不回退 mock，避免出现“假搜索结果导致下载失败”的误导
            return [];
        }
    }
}

