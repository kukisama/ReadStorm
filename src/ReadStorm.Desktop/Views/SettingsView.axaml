<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:ReadStorm.Desktop.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             x:Class="ReadStorm.Desktop.Views.SettingsView"
             x:DataType="vm:SettingsViewModel">

    <ScrollViewer>
        <StackPanel Margin="8" Spacing="12" MaxWidth="1050" HorizontalAlignment="Left">

            <!-- ■ 下载设置 -->
            <TextBlock Text="■ 下载设置" FontWeight="Bold" FontSize="14" />
            <Grid ColumnDefinitions="160,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" ColumnSpacing="8" RowSpacing="8">
                <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Text="工作目录"
                           ToolTip.Tip="下载的书籍文件存放位置" />
                <Grid Grid.Row="0" Grid.Column="1" ColumnDefinitions="*,Auto" ColumnSpacing="4">
                    <TextBox Grid.Column="0" Text="{Binding DownloadPath}" IsReadOnly="True" />
                    <Button Grid.Column="1" Content="浏览" MinWidth="60"
                            Command="{Binding BrowseDownloadPathCommand}" />
                </Grid>

                <TextBlock Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Text="并发线程"
                           ToolTip.Tip="同时下载的最大章节数，值越大速度越快但越容易被网站封禁" />
                <NumericUpDown Grid.Row="1" Grid.Column="1" Minimum="1" Maximum="64" Value="{Binding MaxConcurrency}" />

                <TextBlock Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" Text="聚合搜索并发"
                           ToolTip.Tip="选择「全部书源」搜索时的最大并行请求数" />
                <NumericUpDown Grid.Row="2" Grid.Column="1" Minimum="1" Maximum="64" Value="{Binding AggregateSearchMaxConcurrency}" />

                <TextBlock Grid.Row="3" Grid.Column="0" VerticalAlignment="Center" Text="最小间隔(ms)"
                           ToolTip.Tip="两次章节下载请求之间的最小等待时间（毫秒），防止过快触发反爬" />
                <NumericUpDown Grid.Row="3" Grid.Column="1" Minimum="50" Maximum="10000" Value="{Binding MinIntervalMs}" />

                <TextBlock Grid.Row="4" Grid.Column="0" VerticalAlignment="Center" Text="最大间隔(ms)"
                           ToolTip.Tip="两次章节下载请求之间的最大等待时间（毫秒），随机取 [最小, 最大] 区间" />
                <NumericUpDown Grid.Row="4" Grid.Column="1" Minimum="50" Maximum="20000" Value="{Binding MaxIntervalMs}" />

                <TextBlock Grid.Row="5" Grid.Column="0" VerticalAlignment="Center" Text="导出格式"
                           ToolTip.Tip="书籍导出时的文件格式" />
                <ComboBox Grid.Row="5" Grid.Column="1"
                          ItemsSource="{Binding ExportFormatOptions}"
                          SelectedItem="{Binding ExportFormat}" />
            </Grid>

            <!-- ■ 网络设置 -->
            <TextBlock Text="■ 网络设置" FontWeight="Bold" FontSize="14" Margin="0,8,0,0" />
            <Grid ColumnDefinitions="160,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="8" RowSpacing="8">
                <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Text="启用代理"
                           ToolTip.Tip="开启后所有网络请求将通过代理服务器转发" />
                <CheckBox Grid.Row="0" Grid.Column="1" IsChecked="{Binding ProxyEnabled}" />

                <TextBlock Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Text="代理主机"
                           ToolTip.Tip="代理服务器地址，如 127.0.0.1" />
                <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding ProxyHost}" />

                <TextBlock Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" Text="代理端口"
                           ToolTip.Tip="代理服务器端口号，如 7890" />
                <NumericUpDown Grid.Row="2" Grid.Column="1" Minimum="1" Maximum="65535" Value="{Binding ProxyPort}" />
            </Grid>

            <!-- ■ 高级设置 -->
            <TextBlock Text="■ 高级设置" FontWeight="Bold" FontSize="14" Margin="0,8,0,0" />
            <Grid ColumnDefinitions="160,*" RowDefinitions="Auto,Auto" ColumnSpacing="8" RowSpacing="8">
                <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Text="诊断日志"
                           ToolTip.Tip="开启后记录详细调试信息，用于排查问题" />
                <CheckBox Grid.Row="0" Grid.Column="1" Content="启用诊断日志（默认关闭）"
                          IsChecked="{Binding EnableDiagnosticLog}" />

                <TextBlock Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Text="启动自动续传"
                           ToolTip.Tip="应用启动时自动检测未完成下载并续传/更新" />
                <CheckBox Grid.Row="1" Grid.Column="1" Content="启动时自动续传/更新（默认关闭）"
                          IsChecked="{Binding AutoResumeAndRefreshOnStartup}" />
            </Grid>

            <!-- ■ 数据管理 -->
            <TextBlock Text="■ 数据管理" FontWeight="Bold" FontSize="14" Margin="0,8,0,0" />
            <StackPanel Orientation="Horizontal" Spacing="8">
                <Button MinWidth="120" Content="导出诊断日志" Command="{Binding ExportDiagnosticLogCommand}" />
                <Button MinWidth="120" Content="导出书库数据库" Command="{Binding ExportDatabaseCommand}" />
            </StackPanel>

            <!-- 保存按钮 + 就地反馈 -->
            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right" Margin="0,8,0,0">
                <TextBlock Text="{Binding SaveFeedback}" VerticalAlignment="Center"
                           Foreground="#10B981" FontSize="13" />
                <Button MinWidth="120" Content="保存设置" Command="{Binding SaveSettingsCommand}" />
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</UserControl>
