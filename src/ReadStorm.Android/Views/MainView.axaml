<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:ReadStorm.Desktop.ViewModels"
             xmlns:dm="using:ReadStorm.Domain.Models"
             xmlns:views="using:ReadStorm.Desktop.Views"
             x:Class="ReadStorm.Desktop.Views.MainView"
             x:DataType="vm:MainWindowViewModel">

    <UserControl.Resources>
        <views:Base64ImageConverter x:Key="Base64ImageConverter"/>
    </UserControl.Resources>

    <UserControl.Styles>
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• è§¦æŽ§å‹å¥½å…¨å±€æ ·å¼ï¼ˆMinHeight=48dpï¼‰ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Style Selector="Button">
            <Setter Property="MinHeight" Value="48"/>
            <Setter Property="Padding" Value="14,10"/>
            <Setter Property="FontSize" Value="15"/>
        </Style>
        <Style Selector="TextBox">
            <Setter Property="MinHeight" Value="48"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="Padding" Value="12,8"/>
        </Style>
        <Style Selector="ComboBox">
            <Setter Property="MinHeight" Value="48"/>
            <Setter Property="FontSize" Value="15"/>
        </Style>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TabControl éšè—æ ‡å¤´ï¼ˆä»…ä¿ç•™å†…å®¹åˆ‡æ¢ï¼‰ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- ä¸æ›¿æ¢æ¨¡æ¿ï¼Œä»…é€šè¿‡æ ·å¼éšè—æ ‡ç­¾æ ï¼Œä¿ç•™ Semi.Avalonia åŽŸå§‹æ¨¡æ¿çš„å†…å®¹ç»‘å®š -->
        <Style Selector="TabControl#MainTabControl /template/ ItemsPresenter#PART_ItemsPresenter">
            <Setter Property="MaxHeight" Value="0"/>
            <Setter Property="Opacity" Value="0"/>
            <Setter Property="IsHitTestVisible" Value="False"/>
        </Style>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• åº•éƒ¨å¯¼èˆªæ æŒ‰é’® â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Style Selector="Button.nav-item">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#94A3B8"/>
            <Setter Property="Padding" Value="4"/>
            <Setter Property="MinHeight" Value="56"/>
            <Setter Property="MinWidth" Value="64"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="CornerRadius" Value="0"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        <Style Selector="Button.nav-item.active">
            <Setter Property="Foreground" Value="#60A5FA"/>
        </Style>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• "æ›´å¤š"é¡µèœå•é¡¹ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Style Selector="Button.more-item">
            <Setter Property="Background" Value="White"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="MinHeight" Value="56"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Margin" Value="0,2"/>
        </Style>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• é˜…è¯»å™¨å·¥å…·æ æŒ‰é’® â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Style Selector="Button.reader-btn">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="MinHeight" Value="44"/>
            <Setter Property="MinWidth" Value="44"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ä»»åŠ¡æ“ä½œå°æŒ‰é’® â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Style Selector="Button.task-action">
            <Setter Property="MinHeight" Value="36"/>
            <Setter Property="Padding" Value="10,4"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>
    </UserControl.Styles>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ä¸»å¸ƒå±€ï¼šé¡¶éƒ¨æ  + å†…å®¹åŒº + åº•éƒ¨å¯¼èˆªæ 
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <Grid RowDefinitions="Auto,*,Auto" Background="#F6F7F9">

        <!-- â•â•â• Row 0ï¼šä¸»é¡µé¢é¡¶éƒ¨æ ï¼ˆæœç´¢/ä»»åŠ¡/ä¹¦æž¶æ—¶å¯è§ï¼‰ â•â•â• -->
        <Border x:Name="PrimaryHeader" Grid.Row="0" Background="#1E293B" Padding="14,10">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel Grid.Column="0" Spacing="4">
                    <TextBlock Text="ReadStorm"
                               FontSize="20" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="{Binding StatusMessage}"
                               Foreground="#CBD5E1" FontSize="12"
                               TextWrapping="Wrap" MaxLines="2"/>
                </StackPanel>
                <TextBlock Grid.Column="1"
                           Text="{Binding SearchDownload.ActiveDownloadSummary}"
                           Foreground="#60A5FA" FontSize="12"
                           VerticalAlignment="Bottom"/>
            </Grid>
        </Border>

        <!-- â•â•â• Row 0ï¼šå­é¡µé¢é¡¶éƒ¨æ ï¼ˆè¯Šæ–­/è§„åˆ™/è®¾ç½®/æ—¥å¿—/é˜…è¯»å™¨è¿”å›žæ—¶å¯è§ï¼‰ â•â•â• -->
        <Border x:Name="SubPageHeader" Grid.Row="0" Background="#1E293B" Padding="8,6"
                IsVisible="False">
            <Grid ColumnDefinitions="Auto,*">
                <Button Grid.Column="0" Content="â† è¿”å›ž"
                        Background="Transparent" Foreground="White"
                        MinHeight="40" Padding="8,4"
                        BorderThickness="0"
                        x:Name="BackButton" Click="OnBackButtonClick"/>
                <TextBlock Grid.Column="1" x:Name="SubPageTitle"
                           FontSize="18" FontWeight="Bold" Foreground="White"
                           VerticalAlignment="Center" Margin="8,0,0,0"/>
            </Grid>
        </Border>

        <!-- â•â•â• Row 1ï¼šå†…å®¹åŒºåŸŸ â•â•â• -->
        <Panel Grid.Row="1">

            <!-- ä¸» TabControlï¼ˆæ ‡å¤´å·²éšè—ï¼Œç”±åº•éƒ¨å¯¼èˆªæ åˆ‡æ¢ï¼‰ -->
            <!-- ç´¢å¼•æ˜ å°„ï¼š0æœç´¢ 1ä»»åŠ¡ 2è¯Šæ–­ 3ä¹¦æž¶ 4é˜…è¯» 5è§„åˆ™ 6è®¾ç½® 7æ—¥å¿— -->
            <TabControl x:Name="MainTabControl" SelectedIndex="{Binding SelectedTabIndex}">

                <!-- â•â•â•â•â•â•â•â•â•â• Tab 0ï¼šæœç´¢ â•â•â•â•â•â•â•â•â•â• -->
                <TabItem>
                    <Grid DataContext="{Binding SearchDownload}"
                          RowDefinitions="Auto,Auto,Auto,*" Margin="12" RowSpacing="8">
                        <!-- ä¹¦æºé€‰æ‹© + åˆ·æ–° -->
                        <Grid Grid.Row="0" ColumnDefinitions="*,Auto" ColumnSpacing="8">
                            <ComboBox Grid.Column="0"
                                      ItemsSource="{Binding Sources}"
                                      SelectedValueBinding="{ReflectionBinding Id}"
                                      SelectedValue="{Binding SelectedSourceId}"
                                      HorizontalAlignment="Stretch">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate x:DataType="vm:SourceItem">
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <TextBlock Text="{Binding HealthDot}" Foreground="{Binding HealthColor}"/>
                                            <TextBlock Text="{Binding Name}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <Button Grid.Column="1" Content="ðŸ”„" MinWidth="48"
                                    Command="{Binding RefreshSourceHealthCommand}"
                                    ToolTip.Tip="åˆ·æ–°ä¹¦æºçŠ¶æ€"/>
                        </Grid>

                        <!-- æœç´¢æ¡† + æœç´¢æŒ‰é’® -->
                        <Grid Grid.Row="1" ColumnDefinitions="*,Auto" ColumnSpacing="8">
                            <TextBox Grid.Column="0"
                                     Watermark="è¾“å…¥ä¹¦åæˆ–ä½œè€…"
                                     Text="{Binding SearchKeyword}"/>
                            <Button Grid.Column="1" Content="æœç´¢" MinWidth="72"
                                    Command="{Binding SearchCommand}"/>
                        </Grid>

                        <!-- åŠ å…¥ä¸‹è½½é˜Ÿåˆ— -->
                        <Button Grid.Row="2" Content="åŠ å…¥ä¸‹è½½é˜Ÿåˆ—"
                                HorizontalAlignment="Stretch"
                                Command="{Binding QueueDownloadCommand}"/>

                        <!-- æœç´¢ç»“æžœ / Loading / æ— ç»“æžœ -->
                        <Panel Grid.Row="3">
                            <!-- Loading -->
                            <StackPanel IsVisible="{Binding IsSearching}"
                                        VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="10">
                                <ProgressBar IsIndeterminate="True" Width="200"/>
                                <TextBlock Text="æœç´¢ä¸­ï¼Œè¯·ç¨å€™â€¦" HorizontalAlignment="Center" Foreground="#64748B"/>
                            </StackPanel>

                            <!-- æ— ç»“æžœ -->
                            <TextBlock IsVisible="{Binding HasNoSearchResults}"
                                       Text="æœªæ‰¾åˆ°ç»“æžœï¼Œè¯·å°è¯•å…¶ä»–å…³é”®å­—æˆ–åˆ·æ–°ä¹¦æºçŠ¶æ€"
                                       Foreground="#64748B" FontSize="14"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       TextWrapping="Wrap" Margin="20"/>

                            <!-- æœç´¢ç»“æžœå¡ç‰‡åˆ—è¡¨ -->
                            <ListBox ItemsSource="{Binding SearchResults}"
                                     SelectedItem="{Binding SelectedSearchResult}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="White" BorderBrush="#E2E8F0"
                                                BorderThickness="1" CornerRadius="8"
                                                Padding="12" Margin="0,0,0,8"
                                                BoxShadow="0 1 3 0 #0D000000">
                                            <StackPanel Spacing="4">
                                                <TextBlock Text="{Binding Title}"
                                                           FontWeight="{DynamicResource CardTitleFontWeight}"
                                                           TextWrapping="Wrap" FontSize="16"/>
                                                <TextBlock Text="{Binding Author, StringFormat=ä½œè€…ï¼š{0}}"
                                                           FontSize="13"/>
                                                <TextBlock Text="{Binding SourceName, StringFormat=æ¥æºï¼š{0}}"
                                                           FontSize="13"/>
                                                <TextBlock Text="{Binding LatestChapter, StringFormat=æœ€æ–°ï¼š{0}}"
                                                           FontSize="13" Foreground="#64748B"
                                                           TextWrapping="Wrap"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Panel>
                    </Grid>
                </TabItem>

                <!-- â•â•â•â•â•â•â•â•â•â• Tab 1ï¼šä¸‹è½½ä»»åŠ¡ â•â•â•â•â•â•â•â•â•â• -->
                <TabItem>
                    <Grid DataContext="{Binding SearchDownload}"
                          RowDefinitions="Auto,Auto,*" Margin="12" RowSpacing="8">
                        <!-- å…¨éƒ¨åœæ­¢ / å…¨éƒ¨å¼€å§‹ + çŠ¶æ€è¿‡æ»¤ -->
                        <Grid Grid.Row="0" ColumnDefinitions="Auto,Auto,*" ColumnSpacing="8">
                            <Button Grid.Column="0" Content="â¸ å…¨éƒ¨åœæ­¢" FontSize="13"
                                    MinHeight="40" Padding="10,6"
                                    Command="{Binding StopAllDownloadsCommand}"/>
                            <Button Grid.Column="1" Content="â–¶ å…¨éƒ¨å¼€å§‹" FontSize="13"
                                    MinHeight="40" Padding="10,6"
                                    Command="{Binding StartAllDownloadsCommand}"/>
                            <ComboBox Grid.Column="2"
                                      ItemsSource="{Binding TaskFilterStatusOptions}"
                                      SelectedItem="{Binding TaskFilterStatus}"
                                      MinHeight="40"/>
                        </Grid>

                        <!-- ä¸‹è½½æ‘˜è¦ -->
                        <TextBlock Grid.Row="1"
                                   Text="{Binding ActiveDownloadSummary}"
                                   Foreground="#64748B" FontSize="13"/>

                        <!-- ä»»åŠ¡åˆ—è¡¨ -->
                        <ListBox Grid.Row="2" ItemsSource="{Binding FilteredDownloadTasks}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="White" BorderBrush="#E2E8F0"
                                            BorderThickness="1" CornerRadius="8"
                                            Padding="12" Margin="0,0,0,8"
                                            BoxShadow="0 1 3 0 #0D000000">
                                        <Grid RowDefinitions="Auto,Auto,Auto,Auto">
                                            <TextBlock Grid.Row="0" Text="{Binding BookTitle}"
                                                       FontWeight="{DynamicResource CardTitleFontWeight}"
                                                       TextWrapping="Wrap" FontSize="15"/>
                                            <Grid Grid.Row="1" ColumnDefinitions="Auto,*" Margin="0,4,0,0">
                                                <TextBlock Grid.Column="0"
                                                           Text="{Binding Status, StringFormat=çŠ¶æ€ï¼š{0}}"
                                                           FontSize="13" Foreground="#64748B"/>
                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding ChapterProgressDisplay}"
                                                           FontSize="13" Foreground="#64748B"
                                                           HorizontalAlignment="Right"/>
                                            </Grid>
                                            <Grid Grid.Row="2" ColumnDefinitions="*,Auto" Margin="0,6,0,0">
                                                <ProgressBar Grid.Column="0"
                                                             Minimum="0" Maximum="100"
                                                             Value="{Binding ProgressPercent}"
                                                             Height="6" Margin="0,0,8,0"/>
                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding ProgressPercent, StringFormat={}{0}%}"
                                                           FontSize="13" Foreground="#2563EB"
                                                           VerticalAlignment="Center"/>
                                            </Grid>
                                            <StackPanel Grid.Row="3" Orientation="Horizontal"
                                                        Spacing="6" Margin="0,6,0,0">
                                                <Button Content="æš‚åœ" Classes="task-action"
                                                        IsVisible="{Binding CanPause}"
                                                        Command="{Binding $parent[ListBox].DataContext.PauseDownloadCommand}"
                                                        CommandParameter="{Binding}"/>
                                                <Button Content="æ¢å¤" Classes="task-action"
                                                        IsVisible="{Binding CanResume}"
                                                        Command="{Binding $parent[ListBox].DataContext.ResumeDownloadTaskCommand}"
                                                        CommandParameter="{Binding}"/>
                                                <Button Content="é‡è¯•" Classes="task-action"
                                                        IsVisible="{Binding CanRetry}"
                                                        Command="{Binding $parent[ListBox].DataContext.RetryDownloadCommand}"
                                                        CommandParameter="{Binding}"/>
                                                <Button Content="å–æ¶ˆ" Classes="task-action"
                                                        IsVisible="{Binding CanCancel}"
                                                        Command="{Binding $parent[ListBox].DataContext.CancelDownloadCommand}"
                                                        CommandParameter="{Binding}"/>
                                                <Button Content="åˆ é™¤" Classes="task-action"
                                                        IsVisible="{Binding CanDelete}"
                                                        Foreground="#EF4444"
                                                        Command="{Binding $parent[ListBox].DataContext.DeleteDownloadCommand}"
                                                        CommandParameter="{Binding}"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </TabItem>

                <!-- â•â•â•â•â•â•â•â•â•â• Tab 2ï¼šä¹¦æºè¯Šæ–­ï¼ˆå­é¡µé¢ï¼‰ â•â•â•â•â•â•â•â•â•â• -->
                <TabItem>
                    <Grid DataContext="{Binding Diagnostic}"
                          RowDefinitions="Auto,Auto,Auto,*" Margin="16" RowSpacing="8">
                        <Button Grid.Row="0" Content="ä¸€é”®è¯Šæ–­å…¨éƒ¨ä¹¦æº"
                                HorizontalAlignment="Stretch"
                                Command="{Binding RunBatchDiagnosticCommand}"/>
                        <Border Grid.Row="1" Background="#EFF6FF" CornerRadius="8" Padding="12">
                            <TextBlock Text="{Binding DiagnosticSummary}"
                                       TextWrapping="Wrap" FontSize="13" Foreground="#334155"/>
                        </Border>
                        <ComboBox Grid.Row="2"
                                  ItemsSource="{Binding DiagnosticSourceNames}"
                                  SelectedItem="{Binding SelectedDiagnosticSource}"
                                  HorizontalAlignment="Stretch"/>
                        <ListBox Grid.Row="3" ItemsSource="{Binding DiagnosticLines}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding}" FontFamily="monospace"
                                               FontSize="12" TextWrapping="NoWrap"/>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </TabItem>

                <!-- â•â•â•â•â•â•â•â•â•â• Tab 3ï¼šä¹¦æž¶ï¼ˆå®«æ ¼æ¨¡å¼ï¼‰ â•â•â•â•â•â•â•â•â•â• -->
                <TabItem>
                    <Grid DataContext="{Binding Bookshelf}"
                          RowDefinitions="Auto,Auto,*" Margin="12" RowSpacing="8">
                        <!-- å·¥å…·æ ï¼šæŽ’åº + æ£€æŸ¥å…¨éƒ¨æ›´æ–° -->
                        <Grid Grid.Row="0" ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8">
                            <ComboBox Grid.Column="0"
                                      ItemsSource="{Binding BookshelfSortOptions}"
                                      SelectedItem="{Binding BookshelfSortMode}"
                                      MinHeight="40" FontSize="13"/>
                            <Button Grid.Column="1" Content="ðŸ”„ æ£€æŸ¥æ›´æ–°"
                                    MinHeight="40" Padding="10,6" FontSize="13"
                                    Command="{Binding CheckAllNewChaptersCommand}"/>
                        </Grid>

                        <!-- æœç´¢æ¡† -->
                        <TextBox Grid.Row="1" Watermark="æœç´¢ä¹¦åæˆ–ä½œè€…"
                                 Text="{Binding BookshelfFilterText}"/>

                        <!-- å®«æ ¼ä¹¦æž¶ï¼ˆ2åˆ—ï¼‰ -->
                        <ScrollViewer Grid.Row="2">
                            <ItemsControl ItemsSource="{Binding FilteredDbBooks}"
                                          x:Name="BookshelfItemsControl">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Columns="2"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="White" CornerRadius="8"
                                                Padding="8" Margin="4"
                                                BoxShadow="0 1 3 0 #1A000000"
                                                Tapped="OnBookshelfItemTapped">
                                            <Border.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem Header="ðŸ“– ç»§ç»­é˜…è¯»" Click="OnBookReadClick"/>
                                                    <MenuItem Header="â¬‡ï¸ ç»­ä¼ ä¸‹è½½" Click="OnBookResumeClick"/>
                                                    <MenuItem Header="ðŸ”„ æ£€æŸ¥æ›´æ–°" Click="OnBookCheckUpdateClick"/>
                                                    <MenuItem Header="ðŸ“¤ å¯¼å‡º txt" Click="OnBookExportClick"/>
                                                    <MenuItem Header="ðŸ–¼ åˆ·æ–°å°é¢" Click="OnBookRefreshCoverClick"/>
                                                    <Separator/>
                                                    <MenuItem Header="ðŸ—‘ åˆ é™¤ä¹¦ç±" Click="OnBookDeleteClick"/>
                                                </ContextMenu>
                                            </Border.ContextMenu>
                                            <Grid RowDefinitions="120,Auto,Auto,Auto">
                                                <!-- å°é¢ / å ä½ç¬¦ -->
                                                <Panel Grid.Row="0" Background="#F1F5F9"
                                                       ClipToBounds="True">
                                                    <Image Source="{Binding CoverDisplayData, Converter={StaticResource Base64ImageConverter}}"
                                                           IsVisible="{Binding HasCover}"
                                                           Stretch="UniformToFill"/>
                                                    <TextBlock Text="{Binding TitleInitial}"
                                                               FontSize="36" Foreground="#94A3B8"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center"
                                                               IsVisible="{Binding !HasCover}"/>
                                                </Panel>
                                                <!-- ä¹¦å -->
                                                <TextBlock Grid.Row="1" Text="{Binding Title}"
                                                           FontSize="14"
                                                           FontWeight="{DynamicResource CardTitleFontWeight}"
                                                           TextTrimming="CharacterEllipsis"
                                                           MaxLines="1" Margin="0,6,0,0"/>
                                                <!-- ä½œè€… -->
                                                <TextBlock Grid.Row="2" Text="{Binding Author}"
                                                           FontSize="11" Foreground="#64748B"
                                                           TextTrimming="CharacterEllipsis"
                                                           MaxLines="1"/>
                                                <!-- è¿›åº¦ -->
                                                <StackPanel Grid.Row="3" Orientation="Horizontal"
                                                            Spacing="4" Margin="0,2,0,0">
                                                    <ProgressBar Minimum="0" Maximum="100"
                                                                 Value="{Binding ProgressPercent}"
                                                                 Height="4" Width="60"
                                                                 Foreground="#2563EB"/>
                                                    <TextBlock Text="{Binding ProgressPercent, StringFormat={}{0}%}"
                                                               FontSize="11" Foreground="#2563EB"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </TabItem>

                <!-- â•â•â•â•â•â•â•â•â•â• Tab 4ï¼šé˜…è¯»å™¨ï¼ˆå…¨å±æ²‰æµ¸å¼ï¼‰ â•â•â•â•â•â•â•â•â•â• -->
                <TabItem IsVisible="{Binding IsReaderTabVisible}">
                    <Panel DataContext="{Binding Reader}"
                           PointerPressed="OnReaderPointerPressed"
                           PointerReleased="OnReaderPointerReleased">
                        <!-- é˜…è¯»æ­£æ–‡ -->
                        <Border Background="{Binding ReaderBackground}">
                            <ScrollViewer x:Name="ReaderScrollViewer"
                                          VerticalScrollBarVisibility="Hidden"
                                          HorizontalScrollBarVisibility="Disabled"
                                          Tapped="OnReaderContentTapped">
                                <ItemsControl ItemsSource="{Binding ReaderParagraphs}"
                                              Margin="20,12" HorizontalAlignment="Stretch">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}"
                                                       Foreground="{Binding $parent[ItemsControl].DataContext.ReaderForeground}"
                                                       FontSize="{Binding $parent[ItemsControl].DataContext.ReaderFontSize}"
                                                       FontFamily="{Binding $parent[ItemsControl].DataContext.ReaderFontFamily}"
                                                       LineHeight="{Binding $parent[ItemsControl].DataContext.ReaderLineHeight}"
                                                       Margin="{Binding $parent[ItemsControl].DataContext.ParagraphMargin}"
                                                       TextWrapping="Wrap"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Border>

                        <!-- â•â•â• é˜…è¯»å™¨é¡¶éƒ¨å·¥å…·æ ï¼ˆç‚¹å‡»ä¸­å¤®åŒºåŸŸåˆ‡æ¢ï¼‰ â•â•â• -->
                        <Border x:Name="ReaderTopToolbar"
                                VerticalAlignment="Top" ZIndex="10"
                                Background="#DD1E293B" Padding="8,6"
                                IsVisible="False">
                            <Grid RowDefinitions="Auto,Auto">
                                <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto,Auto,Auto">
                                    <Button Grid.Column="0" Content="â† è¿”å›ž" Classes="reader-btn"
                                            Click="OnReaderBackClick"/>
                                    <TextBlock Grid.Column="1" Text="{Binding ReaderTitle}"
                                               Foreground="White" FontSize="14" FontWeight="Bold"
                                               VerticalAlignment="Center" Margin="4,0"
                                               TextTrimming="CharacterEllipsis"/>
                                    <Button Grid.Column="2" Content="â‰¡" Classes="reader-btn"
                                            Command="{Binding ToggleTocOverlayCommand}"
                                            ToolTip.Tip="ç›®å½•"/>
                                    <Button Grid.Column="3" Content="ðŸ”„" Classes="reader-btn"
                                            Command="{Binding RefreshReaderCommand}"
                                            ToolTip.Tip="åˆ·æ–°"/>
                                    <Button Grid.Column="4" Content="ðŸŒ" Classes="reader-btn"
                                            Command="{Binding OpenBookWebPageCommand}"
                                            ToolTip.Tip="æµè§ˆå™¨æ‰“å¼€"/>
                                </Grid>
                                <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="8" Margin="8,2,0,0">
                                    <TextBlock Text="{Binding SelectedReaderChapter}"
                                               Foreground="#CBD5E1" FontSize="12"
                                               TextTrimming="CharacterEllipsis" MaxWidth="220"/>
                                    <TextBlock Text="{Binding ReaderProgressDisplay}"
                                               Foreground="#60A5FA" FontSize="12"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- â•â•â• é˜…è¯»å™¨åº•éƒ¨å·¥å…·æ  â•â•â• -->
                        <Border x:Name="ReaderBottomToolbar"
                                VerticalAlignment="Bottom" ZIndex="10"
                                Background="#DD1E293B" Padding="8,6,8,16"
                                IsVisible="False">
                            <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                                <Button Grid.Column="0" Content="â—€ ä¸Šä¸€ç« " Classes="reader-btn"
                                        Command="{Binding PreviousChapterCommand}"/>
                                <TextBlock Grid.Column="1"
                                           Text="{Binding ReaderProgressDisplay}"
                                           Foreground="#CBD5E1" FontSize="13"
                                           HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <Button Grid.Column="2" Content="ä¸‹ä¸€ç«  â–¶" Classes="reader-btn"
                                        Command="{Binding NextChapterCommand}"/>
                                <Button Grid.Column="3" Content="âš™" Classes="reader-btn"
                                        Click="OnReaderSettingsClick"/>
                            </Grid>
                        </Border>

                        <!-- â•â•â• ç›®å½•ä¾§æ»‘é¢æ¿ï¼ˆä»Žå³ä¾§è¦†ç›– 2/3 å±å¹•ï¼‰ â•â•â• -->
                        <Grid x:Name="TocOverlay"
                              IsVisible="{Binding IsTocOverlayVisible}"
                              ZIndex="20" Background="#80000000">
                            <Grid ColumnDefinitions="*,2*">
                                <Border Grid.Column="0" Background="Transparent"
                                        Tapped="OnTocBackdropTapped"/>
                                <Border Grid.Column="1" Background="#1E293B">
                                    <Grid RowDefinitions="Auto,*">
                                        <TextBlock Grid.Row="0" Text="ðŸ“‘ ç›®å½•"
                                                   Foreground="White" FontSize="16"
                                                   FontWeight="Bold" Margin="14,12"/>
                                        <ListBox Grid.Row="1"
                                                 ItemsSource="{Binding ReaderChapters}"
                                                 SelectedItem="{Binding SelectedReaderChapter}"
                                                 Background="Transparent">
                                            <ListBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding}"
                                                               Foreground="#CBD5E1"
                                                               FontSize="14"
                                                               Padding="14,10"
                                                               TextTrimming="CharacterEllipsis"/>
                                                </DataTemplate>
                                            </ListBox.ItemTemplate>
                                        </ListBox>
                                    </Grid>
                                </Border>
                            </Grid>
                        </Grid>

                        <!-- â•â•â• é˜…è¯»è®¾ç½®é¢æ¿ï¼ˆåº•éƒ¨å¼¹å‡ºï¼‰ â•â•â• -->
                        <Border x:Name="ReaderSettingsPanel"
                                VerticalAlignment="Bottom" ZIndex="15"
                                Background="#1E293B" Padding="16"
                                CornerRadius="16,16,0,0"
                                IsVisible="False">
                            <StackPanel Spacing="14">
                                <TextBlock Text="é˜…è¯»è®¾ç½®" Foreground="White"
                                           FontSize="16" FontWeight="Bold"/>
                                <!-- å­—å· -->
                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <Button Grid.Column="0" Content="Aâ»" Classes="reader-btn"
                                            Click="OnFontSizeDecClick"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding ReaderFontSize, StringFormat=å­—å·ï¼š{0}}"
                                               Foreground="#CBD5E1" FontSize="14"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    <Button Grid.Column="2" Content="Aâº" Classes="reader-btn"
                                            Click="OnFontSizeIncClick"/>
                                </Grid>
                                <!-- è¡Œè· -->
                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <Button Grid.Column="0" Content="è¡Œ-" Classes="reader-btn"
                                            Click="OnLineHeightDecClick"/>
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding ReaderLineHeight, StringFormat=è¡Œè·ï¼š{0}}"
                                               Foreground="#CBD5E1" FontSize="14"
                                               HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    <Button Grid.Column="2" Content="è¡Œ+" Classes="reader-btn"
                                            Click="OnLineHeightIncClick"/>
                                </Grid>
                                <!-- ä¸»é¢˜é¢„è®¾ -->
                                <TextBlock Text="ä¸»é¢˜" Foreground="#CBD5E1" FontSize="13"/>
                                <ItemsControl ItemsSource="{Binding PaperPresets}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal" Spacing="10"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Button Width="44" Height="44" CornerRadius="22"
                                                    Background="{Binding Background}"
                                                    Foreground="{Binding Foreground}"
                                                    Content="{Binding Name}" FontSize="9"
                                                    Padding="0" MinHeight="0" MinWidth="0"
                                                    Command="{Binding $parent[ItemsControl].DataContext.ApplyPaperPresetCommand}"
                                                    CommandParameter="{Binding}"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <!-- å¤œé—´æ¨¡å¼ -->
                                <Grid ColumnDefinitions="*,Auto">
                                    <TextBlock Grid.Column="0" Text="å¤œé—´æ¨¡å¼"
                                               Foreground="#CBD5E1" FontSize="14"
                                               VerticalAlignment="Center"/>
                                    <ToggleSwitch Grid.Column="1"
                                                  IsChecked="{Binding IsDarkMode}"/>
                                </Grid>
                                <!-- å…³é—­ -->
                                <Button Content="å…³é—­è®¾ç½®" HorizontalAlignment="Stretch"
                                        Click="OnCloseReaderSettingsClick"/>
                            </StackPanel>
                        </Border>

                        <!-- æ¢æºä¸­æç¤º -->
                        <Border IsVisible="{Binding IsSourceSwitching}"
                                Background="#CC000000" ZIndex="30">
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="10">
                                <ProgressBar IsIndeterminate="True" Width="200"/>
                                <TextBlock Text="æ¢æºä¸­ï¼Œè¯·ç¨å€™â€¦" Foreground="White"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </Panel>
                </TabItem>

                <!-- â•â•â•â•â•â•â•â•â•â• Tab 5ï¼šè§„åˆ™ç¼–è¾‘å™¨ï¼ˆå­é¡µé¢ï¼‰ â•â•â•â•â•â•â•â•â•â• -->
                <TabItem>
                    <Grid DataContext="{Binding RuleEditor}"
                          RowDefinitions="Auto,Auto,Auto,*" Margin="16,12" RowSpacing="8">
                        <!-- Row 0: æ“ä½œæŒ‰é’® -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="6">
                            <Button Content="åˆ·æ–°" Command="{Binding LoadRuleListCommand}"
                                    MinHeight="40" Padding="10,6" FontSize="13"/>
                            <Button Content="ï¼‹ æ–°å»º" Command="{Binding NewRuleCommand}"
                                    MinHeight="40" Padding="10,6" FontSize="13"/>
                            <Button Content="ðŸ“‹ å¤åˆ¶" Command="{Binding CopyRuleCommand}"
                                    MinHeight="40" Padding="10,6" FontSize="13"/>
                            <Button Content="ðŸ—‘ åˆ é™¤" Command="{Binding DeleteRuleCommand}"
                                    MinHeight="40" Padding="10,6" FontSize="13"
                                    Foreground="#EF4444"/>
                        </StackPanel>

                        <!-- Row 1: æµ‹è¯• + ä¿å­˜ -->
                        <Grid Grid.Row="1" ColumnDefinitions="*,Auto,Auto" ColumnSpacing="6">
                            <TextBox Grid.Column="0" Watermark="æµ‹è¯•å…³é”®å­—"
                                     Text="{Binding RuleTestKeyword}"/>
                            <Button Grid.Column="1" Content="æµ‹è¯•"
                                    Command="{Binding TestRuleCommand}"
                                    IsEnabled="{Binding !IsRuleTesting}"/>
                            <Button Grid.Column="2" Content="ä¿å­˜"
                                    Command="{Binding SaveRuleCommand}"
                                    IsEnabled="{Binding !IsRuleSaving}"/>
                        </Grid>

                        <!-- Row 2: è§„åˆ™é€‰æ‹© + æ¢å¤ / Debug -->
                        <Grid Grid.Row="2" RowDefinitions="Auto,Auto" RowSpacing="6">
                            <ComboBox Grid.Row="0"
                                      ItemsSource="{Binding RuleEditorRules}"
                                      SelectedItem="{Binding RuleEditorSelectedRule}"
                                      HorizontalAlignment="Stretch">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate x:DataType="vm:RuleListItem">
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <TextBlock Text="{Binding HealthDot}" Foreground="{Binding HealthColor}"/>
                                            <TextBlock Text="{Binding Display}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                            <StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="6">
                                <Button Content="æ¢å¤é»˜è®¤" MinHeight="36" Padding="10,4" FontSize="13"
                                        Command="{Binding ResetRuleToDefaultCommand}"
                                        IsVisible="{Binding RuleHasUserOverride}"/>
                                <Button Content="Debug" MinHeight="36" Padding="10,4" FontSize="13"
                                        Command="{Binding DebugRuleCommand}"
                                        IsEnabled="{Binding !IsRuleTesting}"/>
                                <TextBlock Text="{Binding RuleTestStatus}"
                                           Foreground="#2563EB" FontSize="13"
                                           VerticalAlignment="Center" TextWrapping="Wrap"/>
                            </StackPanel>
                        </Grid>

                        <!-- Row 3: é…ç½®å­—æ®µï¼ˆExpander åˆ†ç»„ï¼Œä¸Žæ¡Œé¢ç«¯å®Œå…¨å¯¹é½ï¼‰ -->
                        <ScrollViewer Grid.Row="3">
                            <StackPanel Spacing="6" Margin="0,0,0,16">

                                <!-- â•â•â• åŸºæœ¬ä¿¡æ¯ â•â•â• -->
                                <Expander Header="åŸºæœ¬ä¿¡æ¯" IsExpanded="True">
                                    <StackPanel Spacing="8" Margin="4">
                                        <TextBox Watermark="ID" Text="{Binding CurrentRule.Id}"/>
                                        <TextBox Watermark="åç§°" Text="{Binding CurrentRule.Name}"/>
                                        <TextBox Watermark="ç½‘ç«™ URL" Text="{Binding CurrentRule.Url}"/>
                                        <TextBox Watermark="å¤‡æ³¨" Text="{Binding CurrentRule.Comment}"/>
                                        <TextBox Watermark="ç±»åž‹ï¼ˆhtml/jsonï¼‰" Text="{Binding CurrentRule.Type}"/>
                                        <TextBox Watermark="è¯­è¨€" Text="{Binding CurrentRule.Language}"/>
                                    </StackPanel>
                                </Expander>

                                <!-- â•â•â• æœç´¢è§„åˆ™ â•â•â• -->
                                <Expander Header="æœç´¢è§„åˆ™">
                                    <StackPanel Spacing="8" Margin="4">
                                        <TextBox Watermark="æœç´¢ URL" Text="{Binding CurrentRule.Search.Url}"/>
                                        <TextBox Watermark="è¯·æ±‚æ–¹å¼ï¼ˆget/postï¼‰" Text="{Binding CurrentRule.Search.Method}"/>
                                        <TextBox Watermark="POST æ•°æ®" Text="{Binding CurrentRule.Search.Data}"/>
                                        <TextBox Watermark="Cookie" Text="{Binding CurrentRule.Search.Cookies}"/>
                                        <TextBox Watermark="ç»“æžœé€‰æ‹©å™¨" Text="{Binding CurrentRule.Search.Result}"/>
                                        <TextBox Watermark="ä¹¦åé€‰æ‹©å™¨" Text="{Binding CurrentRule.Search.BookName}"/>
                                        <TextBox Watermark="ä½œè€…é€‰æ‹©å™¨" Text="{Binding CurrentRule.Search.Author}"/>
                                        <TextBox Watermark="åˆ†ç±»é€‰æ‹©å™¨" Text="{Binding CurrentRule.Search.Category}"/>
                                        <TextBox Watermark="å­—æ•°é€‰æ‹©å™¨" Text="{Binding CurrentRule.Search.WordCount}"/>
                                        <TextBox Watermark="çŠ¶æ€é€‰æ‹©å™¨" Text="{Binding CurrentRule.Search.Status}"/>
                                        <TextBox Watermark="æœ€æ–°ç« èŠ‚é€‰æ‹©å™¨" Text="{Binding CurrentRule.Search.LatestChapter}"/>
                                        <TextBox Watermark="æ›´æ–°æ—¶é—´é€‰æ‹©å™¨" Text="{Binding CurrentRule.Search.LastUpdateTime}"/>
                                    </StackPanel>
                                </Expander>

                                <!-- â•â•â• ä¹¦ç±è¯¦æƒ… â•â•â• -->
                                <Expander Header="ä¹¦ç±è¯¦æƒ…">
                                    <StackPanel Spacing="8" Margin="4">
                                        <TextBox Watermark="ä¹¦åé€‰æ‹©å™¨" Text="{Binding CurrentRule.Book.BookName}"/>
                                        <TextBox Watermark="ä½œè€…é€‰æ‹©å™¨" Text="{Binding CurrentRule.Book.Author}"/>
                                        <TextBox Watermark="ç®€ä»‹é€‰æ‹©å™¨" Text="{Binding CurrentRule.Book.Intro}"/>
                                        <TextBox Watermark="åˆ†ç±»é€‰æ‹©å™¨" Text="{Binding CurrentRule.Book.Category}"/>
                                        <TextBox Watermark="å°é¢ URL é€‰æ‹©å™¨" Text="{Binding CurrentRule.Book.CoverUrl}"/>
                                        <TextBox Watermark="æœ€æ–°ç« èŠ‚é€‰æ‹©å™¨" Text="{Binding CurrentRule.Book.LatestChapter}"/>
                                        <TextBox Watermark="æ›´æ–°æ—¶é—´é€‰æ‹©å™¨" Text="{Binding CurrentRule.Book.LastUpdateTime}"/>
                                        <TextBox Watermark="çŠ¶æ€é€‰æ‹©å™¨" Text="{Binding CurrentRule.Book.Status}"/>
                                    </StackPanel>
                                </Expander>

                                <!-- â•â•â• ç›®å½•è§„åˆ™ â•â•â• -->
                                <Expander Header="ç›®å½•è§„åˆ™">
                                    <StackPanel Spacing="8" Margin="4">
                                        <TextBox Watermark="ç›®å½• URL" Text="{Binding CurrentRule.Toc.Url}"/>
                                        <TextBox Watermark="ç« èŠ‚é¡¹é€‰æ‹©å™¨" Text="{Binding CurrentRule.Toc.Item}"/>
                                        <TextBox Watermark="åç§»é‡" Text="{Binding CurrentRule.Toc.Offset}"/>
                                        <CheckBox Content="å€’åºæŽ’åˆ—" IsChecked="{Binding CurrentRule.Toc.Desc}"
                                                  MinHeight="48"/>
                                    </StackPanel>
                                </Expander>

                                <!-- â•â•â• æ­£æ–‡è§„åˆ™ â•â•â• -->
                                <Expander Header="æ­£æ–‡è§„åˆ™">
                                    <StackPanel Spacing="8" Margin="4">
                                        <TextBox Watermark="æ ‡é¢˜é€‰æ‹©å™¨" Text="{Binding CurrentRule.Chapter.Title}"/>
                                        <TextBox Watermark="æ­£æ–‡é€‰æ‹©å™¨" Text="{Binding CurrentRule.Chapter.Content}"/>
                                        <TextBox Watermark="æ®µè½æ ‡ç­¾" Text="{Binding CurrentRule.Chapter.ParagraphTag}"/>
                                        <CheckBox Content="æ®µè½é—­åˆæ ‡ç­¾" IsChecked="{Binding CurrentRule.Chapter.ParagraphTagClosed}"
                                                  MinHeight="48"/>
                                        <TextBox Watermark="è¿‡æ»¤æ–‡æœ¬" Text="{Binding CurrentRule.Chapter.FilterTxt}"/>
                                        <TextBox Watermark="è¿‡æ»¤æ ‡ç­¾" Text="{Binding CurrentRule.Chapter.FilterTag}"/>
                                    </StackPanel>
                                </Expander>

                                <!-- â•â•â• æµ‹è¯•ç»“æžœä¸Žé¢„è§ˆ â•â•â• -->
                                <Expander Header="æµ‹è¯•ç»“æžœä¸Žé¢„è§ˆ">
                                    <StackPanel Spacing="8" Margin="4">
                                        <TextBlock Text="è¯Šæ–­ä¿¡æ¯"
                                                   FontWeight="{DynamicResource SectionTitleFontWeight}"
                                                   Foreground="#64748B" FontSize="13"/>
                                        <TextBox Text="{Binding RuleTestDiagnostics}"
                                                 AcceptsReturn="True" TextWrapping="Wrap"
                                                 IsReadOnly="True" MinHeight="120"/>

                                        <TextBlock Text="æœç´¢é¢„è§ˆ"
                                                   FontWeight="{DynamicResource SectionTitleFontWeight}"
                                                   Foreground="#64748B" FontSize="13" Margin="0,8,0,0"/>
                                        <TextBox Text="{Binding RuleTestSearchPreview}"
                                                 AcceptsReturn="True" TextWrapping="Wrap"
                                                 IsReadOnly="True" MinHeight="100"
                                                 Background="#F0F4FF"/>

                                        <TextBlock Text="ç›®å½•é¢„è§ˆ"
                                                   FontWeight="{DynamicResource SectionTitleFontWeight}"
                                                   Foreground="#64748B" FontSize="13" Margin="0,8,0,0"/>
                                        <TextBox Text="{Binding RuleTestTocPreview}"
                                                 AcceptsReturn="True" TextWrapping="Wrap"
                                                 IsReadOnly="True" MinHeight="100"
                                                 Background="#F0FFF4"/>

                                        <TextBlock Text="æ­£æ–‡é¢„è§ˆ"
                                                   FontWeight="{DynamicResource SectionTitleFontWeight}"
                                                   Foreground="#64748B" FontSize="13" Margin="0,8,0,0"/>
                                        <TextBox Text="{Binding RuleTestContentPreview}"
                                                 AcceptsReturn="True" TextWrapping="Wrap"
                                                 IsReadOnly="True" MinHeight="100"
                                                 Background="#FFFFF0"/>
                                    </StackPanel>
                                </Expander>

                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </TabItem>

                <!-- â•â•â•â•â•â•â•â•â•â• Tab 6ï¼šè®¾ç½®ï¼ˆå­é¡µé¢ï¼‰ â•â•â•â•â•â•â•â•â•â• -->
                <TabItem>
                    <ScrollViewer DataContext="{Binding Settings}">
                        <StackPanel Margin="16" Spacing="12">
                            <TextBlock Text="ä¸‹è½½è®¾ç½®"
                                       FontWeight="{DynamicResource SectionTitleFontWeight}"
                                       FontSize="16"/>

                            <TextBlock Text="å·¥ä½œç›®å½•" Foreground="#64748B" FontSize="13"/>
                            <TextBox Text="{Binding DownloadPath}" IsReadOnly="True"/>

                            <TextBlock Text="å¹¶å‘çº¿ç¨‹" Foreground="#64748B" FontSize="13"/>
                            <NumericUpDown Minimum="1" Maximum="64"
                                           Value="{Binding MaxConcurrency}"
                                           FormatString="0" Increment="1"/>

                            <TextBlock Text="èšåˆæœç´¢å¹¶å‘" Foreground="#64748B" FontSize="13"/>
                            <NumericUpDown Minimum="1" Maximum="64"
                                           Value="{Binding AggregateSearchMaxConcurrency}"
                                           FormatString="0" Increment="1"/>

                            <TextBlock Text="å¯¼å‡ºæ ¼å¼" Foreground="#64748B" FontSize="13"/>
                            <ComboBox ItemsSource="{Binding ExportFormatOptions}"
                                      SelectedItem="{Binding ExportFormat}"
                                      HorizontalAlignment="Stretch"/>

                            <Button Content="ðŸ’¾ ä¿å­˜è®¾ç½®" HorizontalAlignment="Stretch"
                                    Command="{Binding SaveSettingsCommand}"
                                    Margin="0,8,0,0"/>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- â•â•â•â•â•â•â•â•â•â• Tab 7ï¼šè¯Šæ–­æ—¥å¿— + Debugï¼ˆå­é¡µé¢ï¼‰ â•â•â•â•â•â•â•â•â•â• -->
                <TabItem>
                    <Grid RowDefinitions="Auto,Auto,*">
                        <!-- Debug é¢æ¿ï¼ˆä»… Debug æž„å»ºå¯è§ï¼‰ -->
                        <Border Grid.Row="0" IsVisible="{Binding IsDebugBuild}"
                                Background="#0F172A" BorderBrush="#334155"
                                BorderThickness="1" CornerRadius="8"
                                Padding="10" Margin="12,12,12,0">
                            <StackPanel Spacing="6">
                                <TextBlock Text="[DEBUG] å­—ä½“è‡ªæ£€é¢æ¿"
                                           Foreground="#FBBF24" FontWeight="Bold" FontSize="12"/>
                                <TextBlock Text="ç­–ç•¥ï¼šDebug=ä¿å®ˆå­—é‡ï¼›Release=ä¸»é¢˜é»˜è®¤å­—é‡"
                                           Foreground="#93C5FD" FontSize="11" TextWrapping="Wrap"/>
                                <TextBlock Text="Text-Normalï¼šä¸­æ–‡å­—ä½“æµ‹è¯• ä½ å¥½ï¼ŒReadStorm"
                                           Foreground="White" FontWeight="Normal" FontSize="13"/>
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <Button Content="æŒ‰é’®-Normal" FontWeight="Normal"
                                            MinHeight="36" Padding="8,4"/>
                                    <Button Content="æŒ‰é’®-ç¨³å®šæ¨¡å¼" FontWeight="Normal"
                                            MinHeight="36" Padding="8,4"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- æ—¥å¿—æ“ä½œæ  -->
                        <Button Grid.Row="1" Content="æ¸…ç©ºæ—¥å¿—" Margin="12,8"
                                DataContext="{StaticResource LogViewModel}"
                                Command="{Binding ClearLogCommand}"/>

                        <!-- æ—¥å¿—å†…å®¹ -->
                        <ScrollViewer Grid.Row="2" Margin="12,0,12,12"
                                      HorizontalScrollBarVisibility="Auto"
                                      VerticalScrollBarVisibility="Auto"
                                      DataContext="{StaticResource LogViewModel}">
                            <TextBlock Text="{Binding LogText}"
                                       FontSize="11" FontFamily="monospace"
                                       TextWrapping="NoWrap"
                                       Foreground="#1E293B" Background="#F8FAFC"
                                       Padding="8"/>
                        </ScrollViewer>
                    </Grid>
                </TabItem>
            </TabControl>

            <!-- â•â•â• "æ›´å¤š"é¡µè¦†ç›–é¢æ¿ â•â•â• -->
            <Grid x:Name="MorePanel" IsVisible="False" Background="#F6F7F9">
                <ScrollViewer>
                    <StackPanel Margin="12" Spacing="4">
                        <TextBlock Text="æ›´å¤š" FontSize="20" FontWeight="Bold" Margin="4,0,0,12"/>
                        <Button Classes="more-item" Click="OnMoreDiagnosticClick">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <TextBlock Text="ðŸ”§" FontSize="20"/>
                                <TextBlock Text="ä¹¦æºè¯Šæ–­" FontSize="16" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button Classes="more-item" Click="OnMoreRulesClick">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <TextBlock Text="ðŸ“" FontSize="20"/>
                                <TextBlock Text="è§„åˆ™ç®¡ç†" FontSize="16" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button Classes="more-item" Click="OnMoreSettingsClick">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <TextBlock Text="âš™ï¸" FontSize="20"/>
                                <TextBlock Text="è®¾ç½®" FontSize="16" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button Classes="more-item" Click="OnMoreLogClick">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <TextBlock Text="ðŸ“‹" FontSize="20"/>
                                <TextBlock Text="è¯Šæ–­æ—¥å¿—" FontSize="16" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Panel>

        <!-- â•â•â• Row 2ï¼šåº•éƒ¨å¯¼èˆªæ  â•â•â• -->
        <Border x:Name="BottomNavBar" Grid.Row="2"
                Background="#1E293B" Padding="0,4,0,8"
                BorderThickness="0,1,0,0" BorderBrush="#334155">
            <Grid ColumnDefinitions="*,*,*,*">
                <Button Grid.Column="0" x:Name="NavSearch"
                        Classes="nav-item active" Click="OnNavSearchClick">
                    <StackPanel HorizontalAlignment="Center" Spacing="2">
                        <TextBlock Text="ðŸ”" HorizontalAlignment="Center" FontSize="18"/>
                        <TextBlock Text="æœç´¢" HorizontalAlignment="Center" FontSize="11"/>
                    </StackPanel>
                </Button>
                <Button Grid.Column="1" x:Name="NavTasks"
                        Classes="nav-item" Click="OnNavTasksClick">
                    <StackPanel HorizontalAlignment="Center" Spacing="2">
                        <TextBlock Text="ðŸ“‹" HorizontalAlignment="Center" FontSize="18"/>
                        <TextBlock Text="ä»»åŠ¡" HorizontalAlignment="Center" FontSize="11"/>
                    </StackPanel>
                </Button>
                <Button Grid.Column="2" x:Name="NavBookshelf"
                        Classes="nav-item" Click="OnNavBookshelfClick">
                    <StackPanel HorizontalAlignment="Center" Spacing="2">
                        <TextBlock Text="ðŸ“š" HorizontalAlignment="Center" FontSize="18"/>
                        <TextBlock Text="ä¹¦æž¶" HorizontalAlignment="Center" FontSize="11"/>
                    </StackPanel>
                </Button>
                <Button Grid.Column="3" x:Name="NavMore"
                        Classes="nav-item" Click="OnNavMoreClick">
                    <StackPanel HorizontalAlignment="Center" Spacing="2">
                        <TextBlock Text="âš™ï¸" HorizontalAlignment="Center" FontSize="18"/>
                        <TextBlock Text="æ›´å¤š" HorizontalAlignment="Center" FontSize="11"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>
    </Grid>
</UserControl>
