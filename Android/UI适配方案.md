# ReadStorm Android UI 适配方案

> 本文档详细说明将桌面端 UI 适配至 Android 手机屏幕的具体策略、布局方案和交互设计。

---

## 一、桌面端与移动端的核心差异

| 维度 | 桌面端 | Android 移动端 |
|------|--------|---------------|
| 屏幕尺寸 | 1280×800+ | 360×640 ~ 430×932 |
| 交互方式 | 鼠标 + 键盘 | 触控（单击、长按、滑动） |
| 窗口模式 | 可调大小窗口 | 全屏应用 |
| 导航方式 | 左侧标签栏（TabControl） | 底部导航栏 |
| 信息密度 | 高（表格、多列布局） | 低（卡片、单列布局） |
| 弹窗 | Dialog 对话框 | 底部弹出面板 / 全屏页面 |
| 操作 | 双击、右键菜单 | 单击、长按菜单 |

---

## 二、导航架构适配

### 2.1 桌面端：左侧标签栏

```
┌──────────┬────────────────────────────┐
│ 🔍 搜索   │                            │
│ 📚 书架   │        内容区域             │
│ 📖 阅读   │                            │
│ ⚙️ 设置   │                            │
└──────────┴────────────────────────────┘
```

### 2.2 移动端：底部导航栏

```
┌──────────────────────┐
│                      │
│       内容区域        │
│                      │
│                      │
├──────────────────────┤
│ 🔍  📚  📖  ⚙️      │
│ 搜索 书架 阅读 设置   │
└──────────────────────┘
```

### 2.3 实现方式

移动端使用 `MainView`（UserControl）替代桌面端的 `MainWindow`（Window）：

```xml
<UserControl x:Class="ReadStorm.Desktop.Views.MainView">
    <Grid RowDefinitions="*, Auto">
        <!-- 页面内容 -->
        <ContentControl Grid.Row="0"
                        Content="{Binding CurrentPageViewModel}" />

        <!-- 底部导航栏 -->
        <Border Grid.Row="1"
                Background="{DynamicResource SemiColorBg1}"
                BorderThickness="0,1,0,0"
                BorderBrush="{DynamicResource SemiColorBorder}">
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Center"
                        Spacing="32"
                        Margin="0,8,0,12">
                <!-- 各导航按钮 -->
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
```

**ViewModel 完全复用**：`MainView` 绑定与 `MainWindow` 相同的 `MainWindowViewModel`，通过 `CurrentPageViewModel` 属性切换子页面。

---

## 三、各页面适配方案

### 3.1 搜索页

#### 桌面端布局

```
┌──────────────────────────────────────┐
│  [书源下拉] [搜索框___________] [搜索] │
├──────┬──────┬──────┬──────┬─────────┤
│ 书名  │ 作者  │ 最新章节│ 书源  │ 操作  │
├──────┼──────┼──────┼──────┼─────────┤
│ XXX  │ XXX  │ 第N章  │ 源A  │ 下载   │
│ XXX  │ XXX  │ 第N章  │ 源B  │ 下载   │
└──────┴──────┴──────┴──────┴─────────┘
```

#### 移动端布局

```
┌──────────────────────┐
│ [搜索框____________] │
│ [书源选择 ▼]  [搜索]  │
├──────────────────────┤
│ ┌──────────────────┐ │
│ │ 📖 书名           │ │
│ │ ✍️ 作者 · 书源A   │ │
│ │ 最新：第N章       │ │
│ │         [下载 ▶]  │ │
│ └──────────────────┘ │
│ ┌──────────────────┐ │
│ │ 📖 书名           │ │
│ │ ✍️ 作者 · 书源B   │ │
│ │ 最新：第N章       │ │
│ │         [下载 ▶]  │ │
│ └──────────────────┘ │
└──────────────────────┘
```

#### 适配要点

- 搜索栏置顶，全宽输入框
- 搜索结果从表格改为卡片列表，纵向滚动
- 每张卡片显示：书名、作者、书源、最新章节
- 下载操作改为卡片内按钮（替代双击）

### 3.2 书架页

#### 桌面端布局

```
┌──────────────────────────────────────┐
│  [网格视图] [列表视图]   [搜索筛选]    │
├──────┬──────┬──────┬──────┬─────────┤
│ 封面  │ 书名  │ 作者  │ 进度  │ 操作  │
├──────┼──────┼──────┼──────┼─────────┤
│ 🖼   │ XXX  │ XXX  │ 50%  │ 阅读    │
└──────┴──────┴──────┴──────┴─────────┘
```

#### 移动端布局

```
┌──────────────────────┐
│       我的书架        │
├──────────────────────┤
│ ┌────┐  ┌────┐      │
│ │ 🖼 │  │ 🖼 │      │
│ │封面 │  │封面 │      │
│ │    │  │    │      │
│ ├────┤  ├────┤      │
│ │书名 │  │书名 │      │
│ │50% │  │30% │      │
│ └────┘  └────┘      │
│ ┌────┐  ┌────┐      │
│ │ 🖼 │  │ 🖼 │      │
│ │封面 │  │封面 │      │
│ └────┘  └────┘      │
└──────────────────────┘
```

#### 适配要点

- 使用 2-3 列网格布局（`UniformGrid` 或 `ItemsRepeater`）
- 每个项目显示封面缩略图 + 书名 + 阅读进度
- 点击进入阅读，长按弹出操作菜单（删除、导出、详情）
- 网格列数根据屏幕宽度自适应

### 3.3 阅读器页

#### 桌面端布局

```
┌──────────────────────────────────────┐
│ [上一章] [目录] [下一章] 字号+/- 主题 │
├──────────────────────────────────────┤
│                                      │
│          第 N 章  章节标题             │
│                                      │
│          正文内容正文内容正文内容       │
│          正文内容正文内容正文内容       │
│          正文内容正文内容正文内容       │
│                                      │
└──────────────────────────────────────┘
```

#### 移动端布局

```
┌──────────────────────┐
│                      │
│   第 N 章 章节标题    │
│                      │
│   正文内容正文内容    │
│   正文内容正文内容    │
│   正文内容正文内容    │
│   正文内容正文内容    │
│   正文内容正文内容    │
│                      │  ← 点击屏幕中央：显示/隐藏工具栏
│                      │  ← 左滑：下一章
│                      │  ← 右滑：上一章
│                      │
├──────────────────────┤  ← 工具栏（点击后显示）
│ [◀上一章] [目录] [▶下一章] │
│ [字号调节──────●──] │
└──────────────────────┘
```

#### 适配要点

- **全屏阅读**：默认隐藏状态栏和导航栏，沉浸式体验
- **工具栏**：点击屏幕中央区域切换显示/隐藏
- **手势操作**：
  - 上下滑动：内容滚动
  - 左滑：下一章
  - 右滑：上一章
  - 双指缩放：调整字号
- **屏幕常亮**：阅读时保持屏幕不息
- **进度指示**：底部显示当前章节 / 总章节数

### 3.4 设置页

#### 移动端布局

```
┌──────────────────────┐
│       应用设置        │
├──────────────────────┤
│ 阅读设置              │
│ ├─ 字体大小   [──●──] │
│ ├─ 行间距     [──●──] │
│ └─ 主题       [深色 ▼]│
├──────────────────────┤
│ 下载设置              │
│ ├─ 并发数     [3 ▼]   │
│ ├─ 下载路径   [...]   │
│ └─ WiFi限制   [开关]  │
├──────────────────────┤
│ 关于                  │
│ ├─ 版本       1.0.0   │
│ └─ 清除缓存   [清除]  │
└──────────────────────┘
```

#### 适配要点

- 单列垂直列表布局
- 使用分组标题区分设置类别
- 滑块控件用于连续调节（字号、行距）
- 开关控件用于布尔选项

---

## 四、触控交互适配

### 4.1 手势映射

| 桌面端操作 | 移动端替代 | 实现方式 |
|-----------|-----------|---------|
| 双击打开书籍 | 单击打开 | `Tapped` 事件 |
| 右键菜单 | 长按菜单 | `Holding` 事件 / `FlyoutBase` |
| 鼠标悬停提示 | 无 | 省略或改为"信息"按钮 |
| 滚轮翻页 | 上下滑动 | `ScrollViewer` |
| 快捷键翻章 | 左右滑动 | `SwipeGestureRecognizer` |
| 拖拽排序 | 长按拖拽 | `DragAndDrop` |

### 4.2 触控区域规范

移动端触控目标的最小尺寸应为 **48×48 dp**（Android Material Design 标准），确保可点击区域足够大：

```xml
<Button MinWidth="48" MinHeight="48" Padding="12" />
```

---

## 五、响应式布局策略

### 5.1 屏幕尺寸断点

| 类别 | 宽度范围 | 布局策略 |
|------|---------|---------|
| 手机竖屏 | < 600dp | 单列布局，底部导航 |
| 手机横屏 / 小平板 | 600-840dp | 双列网格，底部导航 |
| 平板 | > 840dp | 桌面端布局，左侧导航 |

### 5.2 实现方式

使用 Avalonia 的绑定结合平台判断：

```csharp
// 在 ViewModel 中添加平台判断属性
public bool IsMobileLayout => OperatingSystem.IsAndroid() || OperatingSystem.IsIOS();
```

或使用 XAML 中的 `OnPlatform` 类似方案（通过平台特定资源字典）。

---

## 六、主题与样式

### 6.1 Semi.Avalonia 兼容性

`Semi.Avalonia` 主题在移动端可能存在部分兼容性问题，建议：

1. **优先使用 Semi.Avalonia**：已验证的控件保持使用
2. **回退方案**：如某些控件在移动端表现异常，使用 `Avalonia.Themes.Fluent` 覆盖对应样式
3. **移动端专用样式**：在 `App.axaml` 中通过 `OnPlatform` 加载不同的资源字典

### 6.2 字体适配

- 默认使用 `Inter` 字体（通过 `Avalonia.Fonts.Inter`）
- 中文内容使用系统默认中文字体
- 阅读器字号范围建议：14sp ~ 28sp（手机屏幕）

---

## 七、性能优化建议

| 优化项 | 说明 |
|--------|------|
| **虚拟化列表** | 搜索结果和书架使用 `ItemsRepeater` + 虚拟化，避免加载全部项 |
| **图片懒加载** | 封面图片在可视区域内才加载，减少内存占用 |
| **并发控制** | 移动端下载并发数建议限制为 2-3 个 |
| **内存管理** | AngleSharp 解析大 HTML 页面时注意及时释放 |
| **启动优化** | 延迟加载非首屏页面的 ViewModel（已有懒加载机制） |

---

## 八、总结

UI 适配的核心原则是：**ViewModel 层零改动，仅在 View 层做布局变换**。

| 组件 | 复用/新增 | 工作量 |
|------|----------|--------|
| ViewModel | 100% 复用 | 零 |
| 数据绑定 | 100% 复用 | 零 |
| DataTemplate | 部分复用 | 低 |
| 主布局 | 新增 MainView | 中 |
| 各页面布局 | 需适配 | 中 |
| 手势交互 | 新增 | 低 |
| 样式/主题 | 部分复用 | 低 |

**总 UI 适配代码量**：约 300-500 行 XAML + 50-100 行 C#（手势处理）。
